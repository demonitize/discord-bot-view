<!DOCTYPE html>
<html>

<head>
    <style>
        #navigator {
            background-color: #202225;
            height: 280px;
            padding: 15px;
            overflow: auto;
        }

        #messageViewer {
            background-color: #2c2d30;
            height: 50%;
            padding: 15px;
        }

        .message {
            color: #dcddde;
            padding: 5px;
        }

        .channel {
            background-color: #2c2d30;
            padding: 10px;
            margin: 5px;
        }

        .serverName {
            color: rgb(83, 81, 81);
            border-color: #dcddde;
            padding: 2px;
        }

        .server {
            display: flex;
            flex-direction: row;
            background-color: #202225;
        }
    </style>
</head>

<body>
    <div id="navigator"></div>
    <div id="messageViewer"></div><br>
    <input type="text" id="writeMessage"> <button id="sendMessage">send</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        $(function () {
            var socket = io.connect('http://localhost:8080');

            var storage = {
                "currentChannel" : "",
                "currentServer" : 0,
                "extraInfo" : [],
            }

            setInterval(function () {
                if (storage.currentChannel != "") {
                    var currentChannel = storage.currentChannel
                    var currentServer = storage.currentServer
                    socket.emit('fetchChannelMessages', currentServer, currentChannel)
                }
            }, 5000)

            $("#sendMessage").click(function (event) {
                if ($("#writeMessage").val() != "") {
                    var currentChannel = storage.currentChannel
                    var currentServer = storage.currentServer
                    var message = $("#writeMessage").val()
                    socket.emit('sendChannelMessage', currentServer, currentChannel, message)
                    $("#messageViewer").append(`<span class="message">you said : ${message}</span><br>`)
                    $("#writeMessage").val("")
                }
            })

            $("body").keypress(function (event) {
                if ($("#writeMessage").val() != "" && event.key == "Enter") {
                    var currentChannel = storage.currentChannel
                    var currentServer = storage.currentServer
                    var message = $("#writeMessage").val()
                    socket.emit('sendChannelMessage', currentServer, currentChannel, message)
                    $("#messageViewer").append(`<span class="message">you said : ${message}</span><br>`)
                    $("#writeMessage").val("")
                }
            })

            socket.on('guilds', function (guilds) {
                for (let i = 0; i < guilds.length; i++) {
                    $("#navigator").append(
                        `<div class="server" id="serverContainer${i}"><br><h4 class="serverName" id="server${i}">${guilds[i]}</h4></div><br>`
                    );
                    $(`#server${i}`).click(function (event) {
                        $(`#server${i}`).off('click')
                        socket.emit('serverChannels', guilds[i], i)
                    });
                };
            });
            socket.on('sendChannels', function (channels, serverNumber) {
                for (let i = 0; i < channels.length; i++) {
                    $(`#serverContainer${serverNumber}`).append(
                        `<button class="channel" id="server${serverNumber}channel${i}">${channels[i]}</button><br>`
                    );
                    $(`#server${serverNumber}channel${i}`).click(function (event) {
                        socket.emit('fetchChannelMessages', serverNumber, channels[i]);
                        storage.currentChannel = channels[i]
                        storage.currentServer = serverNumber
                    });
                };
            });
            socket.on('displayMessages', function (messages, extraInfo) {
                $('#messageViewer').html('');
                localStorage.setItem("extra-info", extraInfo)
                for (let i = 0; i < messages.length; i++) {
                    $('#messageViewer').append(
                        `<span class="message" id="message${i}">${messages[i]}</span><br>`);
                }
            });

        });
    </script>
</body>

</html>